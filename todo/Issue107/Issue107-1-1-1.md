ilakkuvaselvimanoharan@MacBookPro tts-next-fast-aws % TASK_ROLE_NAME=$(aws ecs describe-task-definition \
  --task-definition $(aws ecs list-task-definitions \
                        --family-prefix backend \
                        --sort DESC \
                        --max-items 1 \
                        --query 'taskDefinitionArns[0]' \
                        --output text) \
  --query 'taskDefinition.taskRoleArn' --output text | awk -F'/' '{print $NF}')

echo "$TASK_ROLE_NAME"


An error occurred (ClientException) when calling the DescribeTaskDefinition operation: Unable to describe task definition.

Ah — that error usually happens for one of these reasons:

---

### 1️⃣ No task definitions exist for that family

* Check if `backend` really matches your **task definition family**.
* Run this to see all families:

```bash
aws ecs list-task-definitions --sort DESC --output text
```

* You should see something like:

```
arn:aws:ecs:us-east-1:123456789012:task-definition/backend:7
arn:aws:ecs:us-east-1:123456789012:task-definition/backend:6
```

* If nothing appears, either the family name is different, or you’re in the wrong **region** (default region for CLI).

---

### 2️⃣ Wrong AWS region

* By default, AWS CLI uses `~/.aws/config` region or `AWS_DEFAULT_REGION`.
* If your ECS cluster is in `us-east-1` but your CLI defaults to `us-west-2`, you’ll get **“Unable to describe task definition”**.
* Force the region:

```bash
aws ecs list-task-definitions --family-prefix backend --sort DESC --max-items 1 --query 'taskDefinitionArns[0]' --output text --region us-east-1
```

```bash
aws ecs describe-task-definition --task-definition backend:7 --query 'taskDefinition.taskRoleArn' --output text --region us-east-1
```

---

### 3️⃣ Permissions issue

* Your IAM user needs `ecs:DescribeTaskDefinition` permission.
* Without it, AWS returns a similar `ClientException`.

---

✅ Quick test: Just list **all task definitions** in your region to make sure something exists:

```bash
aws ecs list-task-definitions --sort DESC --region us-east-1
```

---

If you want, I can give you a **working one-liner for Zsh** that fetches the **latest task role name** safely, with proper region and error handling, so you can go straight to attaching the policy.

Do you want me to do that?
